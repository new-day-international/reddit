## The contents of this file are subject to the Common Public Attribution
## License Version 1.0. (the "License"); you may not use this file except in
## compliance with the License. You may obtain a copy of the License at
## http://code.reddit.com/LICENSE. The License is based on the Mozilla Public
## License Version 1.1, but Sections 14 and 15 have been added to cover use of
## software over a computer network and provide for limited attribution for the
## Original Developer. In addition, Exhibit A has been modified to be
## consistent with Exhibit B.
##
## Software distributed under the License is distributed on an "AS IS" basis,
## WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
## the specific language governing rights and limitations under the License.
##
## The Original Code is reddit.
##
## The Original Developer is the Initial Developer.  The Initial Developer of
## the Original Code is reddit Inc.
##
## All portions of the code written by reddit are Copyright (c) 2006-2013
## reddit Inc. All Rights Reserved.
###############################################################################

<%! 
   from r2.lib.template_helpers import add_sr, static, join_urls, class_dict, get_domain
   from r2.lib.filters import unsafe
   from r2.lib.pages import SearchForm, ClickGadget, SideContentBox, Login
   from r2.lib import tracking
   from pylons import request
   from r2.lib.strings import strings
   from r2.models import make_feedurl, Sub, Subreddit
%>
<%namespace file="framebuster.html" import="framebuster"/>
<%namespace file="less.html" import="less_js, less_stylesheet"/>
<%namespace file="utils.html" import="tags, classes"/>
<%namespace file="adminbar.html" import="adminbar_stylesheet"/>
<%namespace file="leftbarcssclasses.html" import="left_sidebar_css_classes, main_list_css_classes, tall_collapse_button_css_classes"/>
<%inherit file="base.html"/>

<%def name="Title()">
  %if thing.title:
    ${thing.title}
  %else:
    ${parent.Title()}
  %endif
</%def>

<%def name="global_stylesheets()">
    ${less_stylesheet('lightnet.less')}

<!--   <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" type="text/css" />
 --><!--   <link rel="stylesheet" href="//http://netdna.bootstrapcdn.com/bootswatch/3.0.2/spacelab/bootstrap.min.css" type="text/css" />
 -->  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.2/css/font-awesome.min.css">

<!--   <link rel="stylesheet" href="${static('style.css')}" type="text/css" />
 -->
 </%def>

<%def name="sr_stylesheets()">
  %if c.can_apply_styles and c.allow_styles and c.site.stylesheet_hash:
    <link rel="stylesheet"
          href="${c.site.stylesheet_url}"
          title="applied_subreddit_stylesheet"
          type="text/css">
  %endif
</%def>

<%def name="extra_stylesheets()">
  ${adminbar_stylesheet()}
  %for extra_stylesheet in getattr(thing, 'extra_stylesheets', ()):
    ${less_stylesheet(extra_stylesheet)}
  %endfor
</%def>

<%def name="pagemeta()">
  %if hasattr(thing, "shortlink"):
    <link rel="shorturl" href="http://${thing.shortlink}"/>
  %endif

  <link rel='icon' href="${static('icon.png')}" sizes="256x256" type="image/png" />
  <link rel='shortcut icon' href="${static('favicon.ico?v=3')}" type="image/x-icon" />
  <link rel='apple-touch-icon-precomposed' href="${static('icon-touch.png')}" />
  %if thing.extension_handling:
    <%
       rss = add_sr(join_urls(request.path,'.rss'))
       if thing.extension_handling == "private":
          rss = make_feedurl(c.user, rss)
     %>
    <link rel="alternate" type="application/rss+xml" title="RSS"
          href="${rss}" />
  %endif
</%def>

<%def name="stylesheet()">
  ${self.global_stylesheets()}
  ${self.sr_stylesheets()}
  ${self.extra_stylesheets()}
</%def>

<%def name="javascript()">
  <% from r2.lib import js %>
  ${unsafe(js.use('jquery', 'reddit-init'))}
  % if c.deny_frames:
    <script>if (window != top) top.location = window.location</script>
  % endif
  <!--[if lt IE 9]>
    ${unsafe(js.use('html5shiv'))}
  <![endif]-->
  ${less_js()}
</%def>

<%def name="javascript_bottom()">
  <% from r2.lib import js %>
  ${unsafe(js.use('reddit'))}
  ${unsafe(c.js_preload.use())}
</%def>

<%def name="javascript_run()">
   reddit.cur_site = "${c.site._fullname if hasattr(c.site, '_fullname') else ''}";
</%def>

<%def name="bodyContent()">
  <%include file="adminbar.html"/>
  <%include file="redditheader.html"/>
  
  <div class="row" id="content-row">
    <div id="left-sidebar" class="${left_sidebar_css_classes()} col-fixed">
      ${SearchForm()}

      <h4 class="collapsable" data-toggle="collapse" data-target="#multispaces">
        <i class="glyphicon glyphicon-collapse-down"></i>
        <i class="glyphicon glyphicon-collapse-up"></i> 
      Multispaces
      </h4>
      <ul id="multispaces" class="collapse in space-list list-unstyled">
        <li><a href="/">Subscribed</a></li>
        <li><a href="/space/all/">All</a></li>
        <li><a href="/space/follow/">Following</a></li>
        <li><a href="/space/mod/">Moderated</a></li>
      </ul>

      <h4 class="collapsable" data-toggle="collapse" data-target="#subscribed-spaces"><i class="glyphicon glyphicon-collapse-down"></i><i class="glyphicon glyphicon-collapse-up"></i> Subscribed Spaces</h4>
      <ul id="subscribed-spaces" class="collapse in space-list list-unstyled">
        <li>
          <a class="btn btn-action btn-sm" href="/spaces/mine/">
            <i class="fa fa-cogs"></i> 
            Manage your Spaces
          </a>
          </li>
        <%subreddits = sorted(Subreddit.user_subreddits(c.user, ids=False, stale=True), key = lambda sr: sr.name.lower())%>
        %for sr in subreddits:
          <% is_current_space = "" %>
          <% href = "/space/" + sr.name + "/" %>
          %if thing.canonical_link == href:
            <% is_current_space = "active" %>
          %endif
          <li>
            <a href="${href}" class="${is_current_space}">${sr.name}</a>
          </li>
        %endfor
      </ul>


    </div>


  <% content = getattr(self, "content", None) or thing.content %>
  %if content:
    ##<div class="fixedwidth"><!--IE6sux--></div>
    ##<div class="clearleft"><!--IE6sux--></div>
    <a name="content"></a>
    <div ${tags(id=thing.content_id)} class="content main-list ${thing.css_class} ${main_list_css_classes(rightbar=thing.show_sidebar)}" role="main">
      <div class="tall-collapse-button ${tall_collapse_button_css_classes()}" style=""></div>
      <div class="row">
        ${thing.sort_menu()}
      </div>
      <br />

      ${content()}
    </div>
  %endif

    %if thing.show_sidebar:
      <div id="right-sidebar" class="side col-md-3">
        ${sidebar(content = thing.rightbox())}  
      </div>
    %endif
    </div>
  </div>

  <div class="row">
  %if thing.footer:

    ${thing.footer}
    </div>
    %if not c.user_is_loggedin and not g.read_only_mode:
      %if thing.enable_login_cover:
      <div class="login-popup cover-overlay modal" id="registrationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">${strings.cover_msg}</h4>
            </div>
            <div class="modal-body">
              ${Login(is_popup=True)}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
        <!-- <div class="popup">
          <h1 class="cover-msg"></h1>
        </div>
      </div> remnants -->
      %endif
      <div class="lang-popup cover-overlay" style="display: none">
        <div class="cover" onclick="return hidecover(this)"></div>
        <div class="popup">
          <a href="#" onclick="return hidecover(this)" class="hidecover">
            ${_("close this window")}
          </a>
          <%include file="prefoptions.html" />
        </div>
      </div>
    %endif
  %endif
  ${framebuster()}
  <p class="bottommenu debuginfo col-md-7 col-md-offset-2"><span class="icon">&pi;</span>&nbsp;<span class="content hide">Rendered by PID ${g.reddit_pid} on ${g.reddit_host} at ${c.start_time} running ${g.short_version}.</span></p>
</%def>

<%def name="sidebar(content=None)">
  ${content}
</%def>


