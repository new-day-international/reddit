## The contents of this file are subject to the Common Public Attribution
## License Version 1.0. (the "License"); you may not use this file except in
## compliance with the License. You may obtain a copy of the License at
## http://code.reddit.com/LICENSE. The License is based on the Mozilla Public
## License Version 1.1, but Sections 14 and 15 have been added to cover use of
## software over a computer network and provide for limited attribution for the
## Original Developer. In addition, Exhibit A has been modified to be
## consistent with Exhibit B.
##
## Software distributed under the License is distributed on an "AS IS" basis,
## WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
## the specific language governing rights and limitations under the License.
##
## The Original Code is reddit.
##
## The Original Developer is the Initial Developer.  The Initial Developer of
## the Original Code is reddit Inc.
##
## All portions of the code written by reddit are Copyright (c) 2006-2013
## reddit Inc. All Rights Reserved.
###############################################################################

<%!
   from r2.lib.template_helpers import static, s3_https_if_secure, add_sr
   from r2.models import Sub, FakeSubreddit
   from r2.models.subreddit import DefaultSR
   from r2.lib.pages import SearchForm
   from r2.lib import authentication
%>
<%namespace file="utils.html" import="plain_link, img_link, text_with_links, separator, logout"/>

<script>
var Reddit = {};
Reddit.modhash = "${c.modhash}";
</script>

<div id="header" role="banner" class="navbar navbar-default navbar-fixed-top">
  <div class="">
    <ul class="nav navbar-nav">
      <li class="${'active' if not request.path.startswith(("/spaces", "/people",)) else ''}" id="header-bottom-${'right' if c.lang_rtl else 'left'}">
        <a href="/" id="header-img" class="default-header navbar-brand" title="lightnet">lightnet</a>
      </li>
      <li class="${'active' if request.path.startswith("/spaces") else ''}" ><a href="/spaces/">Spaces</a></li>
      <li class="${'class="active"' if request.path.startswith("/people") else ''}" ><a href="/people/">People</a></li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
      %if not c.user_is_loggedin:
        %if thing.enable_login_cover and not g.read_only_mode:
          <%
            base = g.https_endpoint if not c.cname else ""
            login_url = add_sr(base + "/login", sr_path=False)
          %>
          <li class="" id="header-bottom-${'left' if c.lang_rtl else 'right'}">
            <a class="register login-required" data-toggle="modal" data-target="#registrationModal">register</a>
          </li>
        %endif
      %else:
        <li>
          <a href="#" class="ping" title="Notifications">
            <!-- <i class="fa fa-exclamation-circle fa-emx"></i> --><span>Notifications</span>
          </a>
        </li>
        <li>
          <%
           if c.have_messages:
             mail_img_class = 'havemail'
             mail_img_title = "new mail!"
             mail_path = "/message/unread/"
           else:
             mail_img_class = 'nohavemail'
             mail_img_title = "no new mail"
             mail_path = "/message/inbox/"
          %>
          <a href="${mail_path}" class="ping ${mail_img_class}" title="${mail_img_title}">
            <!-- <i class="fa fa-envelope-o fa-emx"></i> --><span>Messages</span>
            %if c.have_messages:
              <span class="badge label-danger"><i class="fa fa-exclamation"></i></span>
            %endif
          </a>
        </li>
        %if c.show_mod_mail:
          <li>
             <%
                if c.have_mod_messages:
                  mail_img_class = 'havemail'
                  mail_img_title = "new mod mail!"
                  mail_path = "/message/moderator/"
                else:
                  mail_img_class = 'nohavemail'
                  mail_img_title = "no new mod mail"
                  mail_path = "/message/moderator/"
              %>
            <a href="${mail_path}" class="ping ${mail_img_class}" title="${mail_img_title}">
              <!-- <i class="fa fa-gavel fa-emx"></i> --><span>Moderator</span>
              %if c.have_mod_messages:
                <span class="badge label-danger"><i class="fa fa-exclamation"></i></span>
              %endif
            </a>
          </li>
        %endif

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <%
               photo_url = "http://%s/u/%s/profile_photo.jpg" % (g.s3_user_files_host, c.user.name,)
            %>
            <img class="cropped-image-medium link_photo media-object pull-left img-rounded" src="${photo_url}" height="40" width="40" />${c.user.registration_fullname} <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li><a href="/saved/">saved</a></li>
            <li><a href="/account-activity/">recent activity</a></li>
            <li><a href="/prefs">options</a></li>
            <li><a href="#">follow</a></li>
            <li><a href="#">password/email</a></li>
            <li><a href="#">two-factor authentication</a></li>
            <li class="divider"></li>
            <li>
              %if c.user_is_loggedin and authentication.user_can_log_out():
                <a href="/logout" class="postlink" data-action="/logout">${_("logout")}</a>
              %endif
            </li>
          </ul>
        </li>
      %endif
    </ul>
  </div>
</div>
